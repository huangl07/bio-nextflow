10月-12 17:16:26.703 [main] DEBUG nextflow.cli.Launcher - $> nextflow run Ampliseq.nf --fqlist fastq1.list --out demo -resume --meta meta.list
10月-12 17:16:26.920 [main] INFO  nextflow.cli.CmdRun - N E X T F L O W  ~  version 21.04.3
10月-12 17:16:26.972 [main] INFO  nextflow.cli.CmdRun - Launching `Ampliseq.nf` [insane_aryabhata] - revision: a227565957
10月-12 17:16:27.141 [main] DEBUG nextflow.plugin.PluginsFacade - Setting up plugin manager > mode=prod; plugins-dir=/mnt/ilustre/users/dna/.nextflow/plugins
10月-12 17:16:27.145 [main] DEBUG nextflow.plugin.PluginsFacade - Plugins default=[]
10月-12 17:16:27.149 [main] DEBUG nextflow.plugin.PluginsFacade - Plugins local root: .nextflow/plr/empty
10月-12 17:16:27.164 [main] INFO  org.pf4j.DefaultPluginStatusProvider - Enabled plugins: []
10月-12 17:16:27.166 [main] INFO  org.pf4j.DefaultPluginStatusProvider - Disabled plugins: []
10月-12 17:16:27.172 [main] INFO  org.pf4j.DefaultPluginManager - PF4J version 3.4.1 in 'deployment' mode
10月-12 17:16:27.191 [main] INFO  org.pf4j.AbstractPluginManager - No plugins
10月-12 17:16:27.284 [main] DEBUG nextflow.Session - Session uuid: 89ee96c2-4d8d-475a-b515-4b68408c2150
10月-12 17:16:27.284 [main] DEBUG nextflow.Session - Run name: insane_aryabhata
10月-12 17:16:27.287 [main] DEBUG nextflow.Session - Executor pool size: 64
10月-12 17:16:27.385 [main] DEBUG nextflow.cli.CmdRun - 
  Version: 21.04.3 build 5560
  Created: 21-07-2021 15:09 UTC (23:09 CDT)
  System: Linux 4.18.0-240.22.1.el8_3.x86_64
  Runtime: Groovy 3.0.7 on Java HotSpot(TM) 64-Bit Server VM 11.0.11+9-LTS-194
  Encoding: UTF-8 (UTF-8)
  Process: 839226@compute-5-95 [10.2.4.236]
  CPUs: 64 - Mem: 125.2 GB (470.9 MB) - Swap: 4 GB (0)
10月-12 17:16:27.519 [main] DEBUG nextflow.Session - Work-dir: /mnt/ilustre/users/dna/Pipeline/NextFlow/bio-nextflow/Ampliseq/work [lustre]
10月-12 17:16:27.554 [main] DEBUG nextflow.executor.ExecutorFactory - Extension executors providers=[]
10月-12 17:16:27.573 [main] DEBUG nextflow.Session - Observer factory: DefaultObserverFactory
10月-12 17:16:27.955 [main] DEBUG nextflow.Session - Session start invoked
10月-12 17:16:29.906 [main] DEBUG nextflow.script.ScriptRunner - > Launching execution
10月-12 17:16:29.919 [main] DEBUG nextflow.Session - Workflow process names [dsl1]: Hierarchical, PCOA, classify, importfq, Dist, adonis, Alpha, Abundance, DeNoise, Tree, Rarecurve, lafse
10月-12 17:16:30.084 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: slurm
10月-12 17:16:30.084 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'slurm'
10月-12 17:16:30.099 [main] DEBUG nextflow.executor.Executor - [warm up] executor > slurm
10月-12 17:16:30.109 [main] DEBUG n.processor.TaskPollingMonitor - Creating task monitor for executor 'slurm' > capacity: 100; pollInterval: 5s; dumpInterval: 5m 
10月-12 17:16:30.116 [main] DEBUG n.executor.AbstractGridExecutor - Creating executor 'slurm' > queue-stat-interval: 1m
10月-12 17:16:30.304 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: slurm
10月-12 17:16:30.304 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'slurm'
10月-12 17:16:30.321 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: slurm
10月-12 17:16:30.322 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'slurm'
10月-12 17:16:30.333 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: slurm
10月-12 17:16:30.333 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'slurm'
10月-12 17:16:30.344 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: local
10月-12 17:16:30.345 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
10月-12 17:16:30.349 [main] DEBUG nextflow.executor.Executor - [warm up] executor > local
10月-12 17:16:30.355 [main] DEBUG n.processor.LocalPollingMonitor - Creating local task monitor for executor 'local' > cpus=64; memory=125.2 GB; capacity=64; pollInterval=100ms; dumpInterval=5m
10月-12 17:16:30.371 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: local
10月-12 17:16:30.371 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
10月-12 17:16:30.381 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: local
10月-12 17:16:30.381 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
10月-12 17:16:30.390 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: local
10月-12 17:16:30.391 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
10月-12 17:16:30.400 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: local
10月-12 17:16:30.400 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
10月-12 17:16:30.409 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: local
10月-12 17:16:30.410 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
10月-12 17:16:30.417 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: local
10月-12 17:16:30.417 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
10月-12 17:16:30.422 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: local
10月-12 17:16:30.423 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
10月-12 17:16:30.426 [main] DEBUG nextflow.script.ScriptRunner - > Await termination 
10月-12 17:16:30.427 [main] DEBUG nextflow.Session - Session await
10月-12 17:16:30.427 [Actor Thread 4] DEBUG nextflow.conda.CondaCache - Conda found local env for environment=/mnt/ilustre/users/dna/miniconda3/envs/qiime2-2021.8; path=/mnt/ilustre/users/dna/miniconda3/envs/qiime2-2021.8
10月-12 17:16:30.659 [Actor Thread 2] INFO  nextflow.processor.TaskProcessor - [4d/5d0d71] Cached process > importfq
10月-12 17:16:30.737 [Actor Thread 6] INFO  nextflow.processor.TaskProcessor - [50/5256a6] Cached process > DeNoise
10月-12 17:16:30.823 [Actor Thread 10] INFO  nextflow.processor.TaskProcessor - [7d/0d978c] Cached process > classify
10月-12 17:16:30.843 [Actor Thread 11] INFO  nextflow.processor.TaskProcessor - [c4/378239] Cached process > Tree
10月-12 17:16:30.888 [Actor Thread 25] INFO  nextflow.processor.TaskProcessor - [72/7b881a] Cached process > PCOA
10月-12 17:16:30.890 [Actor Thread 13] INFO  nextflow.processor.TaskProcessor - [10/fb445f] Cached process > Hierarchical
10月-12 17:16:30.906 [Actor Thread 18] INFO  nextflow.processor.TaskProcessor - [7f/5cca06] Cached process > Dist
10月-12 17:16:30.911 [Actor Thread 23] INFO  nextflow.processor.TaskProcessor - [f6/f7bfdb] Cached process > adonis
10月-12 17:16:30.927 [Task submitter] DEBUG nextflow.executor.LocalTaskHandler - Launch cmd line: /bin/bash -ue .command.run
10月-12 17:16:30.927 [Actor Thread 19] INFO  nextflow.processor.TaskProcessor - [0d/1bfb83] Cached process > Alpha
10月-12 17:16:30.934 [Task submitter] INFO  nextflow.Session - [b8/6afff9] Submitted process > lafse
10月-12 17:16:30.960 [Actor Thread 22] INFO  nextflow.processor.TaskProcessor - [64/fe006a] Cached process > Rarecurve
10月-12 17:16:31.017 [Actor Thread 20] INFO  nextflow.processor.TaskProcessor - [9f/5919a7] Cached process > Abundance
10月-12 17:18:02.198 [Task monitor] DEBUG n.processor.TaskPollingMonitor - Task completed > TaskHandler[id: 5; name: lafse; status: COMPLETED; exit: 1; error: -; workDir: /mnt/ilustre/users/dna/Pipeline/NextFlow/bio-nextflow/Ampliseq/work/b8/6afff98b08540710d8ae4e9c9b891d]
10月-12 17:18:02.313 [Task monitor] ERROR nextflow.processor.TaskProcessor - Error executing process > 'lafse'

Caused by:
  Process `lafse` terminated with an error exit status (1)

Command executed:

  #!/usr/bin/env Rscript
  library(ggtree)
  library(ggtreeExtra)
  library(ggplot2)
  library(MicrobiotaProcess)
  library(tidytree)
  library(ggstar)
  library(forcats)
  otu <- "table.qza"
  rep <- "rep-seqs.qza"
  tree <- "rooted-tree.qza"
  tax <- "taxonomy.qza"
  sample <- "meta.list"
  ps <- mp_import_qiime2(otuqza=otu, taxaqza=tax,refseqqza=rep,mapfilename=sample,treeqza=tree)
  ps %<>% mp_rrarefy()
  ps %<>%
  mp_diff_analysis(
     .abundance = RelRareAbundanceBySample,
     .group = group,
     first.test.alpha = 0.01
  )
  taxa.tree <- ps %>% mp_extract_tree(type="taxatree")
  taxa.tree %>% select(label, nodeClass, LDAupper, LDAmean, LDAlower, Sign_time, pvalue, fdr) %>% dplyr::filter(!is.na(fdr))
  p1 <- ggtree(
          taxa.tree,
          layout="radial",
          size = 0.3
      ) +
      geom_point(
          data = td_filter(!isTip),
          fill="white",
          size=1,
          shape=21
      )
  p2 <- p1 +
      geom_hilight(
          #data = td_filter(nodeClass == "Phylum"), # This is supported by ggtree >=3.1.3
          mapping = aes(subset = nodeClass == "Phylum", 
                      node = node, 
                      fill = label)
      )
  p3 <- p2 +
      ggnewscale::new_scale("fill") +
      geom_fruit(
          data = td_unnest(RareAbundanceBySample),
          geom = geom_star,
          mapping = aes(
                      x = fct_reorder(Sample, group, .fun=min),
                      size = RelRareAbundanceBySample,
                      fill = group,
                      subset = RelRareAbundanceBySample > 0
                  ),
          starshape = 13,
          starstroke = 0.25,
          offset = 0.04,
          pwidth = 0.8,
          grid.params = list(linetype=2)
      ) +
      scale_size_continuous(
          name="Relative Abundance (%)",
          range = c(1, 3)
      ) 
  p4 <- p3 + geom_tiplab(size=2, offset=7.2)
  p5 <- p4 +
    ggnewscale::new_scale("fill") +
    geom_fruit(
       geom = geom_col,
       mapping = aes(
                     x = LDAmean,
                     fill = Sign_time,
                     subset = !is.na(LDAmean)
                     ),
       orientation = "y",
       offset = 0.3,
       pwidth = 0.5,
       axis.params = list(axis = "x",
                          title = "Log10(LDA)",
                          title.height = 0.01,
                          title.size = 2,
                          text.size = 1.8,
                          vjust = 1),
       grid.params = list(linetype = 2)
    )
  p6 <- p5 +
      ggnewscale::new_scale("size") +
      geom_point(
          data=td_filter(!is.na(fdr)),
          mapping = aes(size = -log10(fdr),
                      fill = Sign_time,
                      ),
          shape = 21,
      )
  p=p6 + theme(
          legend.key.height = unit(0.3, "cm"),
          legend.key.width = unit(0.3, "cm"),
          legend.spacing.y = unit(0.02, "cm"),
          legend.text = element_text(size = 7),
          legend.title = element_text(size = 9),
          )
  ggsave(file="LEfSe.pdf",p2)

Command exit status:
  1

Command output:
  WARNING: ignoring environment value of R_HOME

Command error:
  ggtree v3.0.4  For help: https://yulab-smu.top/treedata-book/
  
  If you use ggtree in published research, please cite the most appropriate paper(s):
  
  1. Guangchuang Yu. Using ggtree to visualize data on tree-like structures. Current Protocols in Bioinformatics, 2020, 69:e96. doi:10.1002/cpbi.96
  2. Guangchuang Yu, Tommy Tsan-Yuk Lam, Huachen Zhu, Yi Guan. Two methods for mapping and visualizing associated data on phylogeny using ggtree. Molecular Biology and Evolution 2018, 35(12):3041-3043. doi:10.1093/molbev/msy194
  3. Guangchuang Yu, David Smith, Huachen Zhu, Yi Guan, Tommy Tsan-Yuk Lam. ggtree: an R package for visualization and annotation of phylogenetic trees with their covariates and other associated data. Methods in Ecology and Evolution 2017, 8(1):28-36. doi:10.1111/2041-210X.12628
  
  
  ggtreeExtra v1.0.4  For help: https://yulab-smu.top/treedata-book/
  
  If you use ggtreeExtra in published research, please cite the paper:
  
  SB Xu, Z Dai, P Guo, X Fu, S Liu, L Zhou, W Tang, T Feng, M Chen, L Zhan, T Wu, E Hu, G Yu. ggtreeExtra: Compact visualization of richly annotated phylogenetic data. Research Square. doi: 10.21203/rs.3.rs-155672/v2, (preprint).
  
  
  
  载入程辑包：‘MicrobiotaProcess’
  
  The following object is masked from ‘package:stats’:
  
      filter
  
  
  载入程辑包：‘tidytree’
  
  The following object is masked from ‘package:stats’:
  
      filter
  
  Warning message:
  The treeqza is a tree file, it is parsing by read.tree function.
  * It is better to parse it with the function of treeio
  * then the treedata or phylo result all can be supported. 
  The RareAbundance was in the MPSE object, please check whether it has been rarefied !
  There are not significantly discriminative features after internal first test !
  Error in (function (classes, fdef, mtable)  : 
    unable to find an inherited method for function ‘mp_extract_tree’ for signature ‘"NULL"’
  Calls: %>% -> mp_extract_tree -> <Anonymous>
  停止执行

Work dir:
  /mnt/ilustre/users/dna/Pipeline/NextFlow/bio-nextflow/Ampliseq/work/b8/6afff98b08540710d8ae4e9c9b891d

Tip: when you have fixed the problem you can continue the execution adding the option `-resume` to the run command line
10月-12 17:18:02.328 [main] DEBUG nextflow.Session - Session await > all process finished
10月-12 17:18:02.338 [Task monitor] DEBUG nextflow.Session - Session aborted -- Cause: Process `lafse` terminated with an error exit status (1)
10月-12 17:18:02.438 [main] DEBUG nextflow.Session - Session await > all barriers passed
10月-12 17:18:02.464 [main] DEBUG nextflow.trace.WorkflowStatsObserver - Workflow completed > WorkflowStats[succeededCount=0; failedCount=1; ignoredCount=0; cachedCount=11; pendingCount=0; submittedCount=0; runningCount=0; retriesCount=0; abortedCount=0; succeedDuration=0ms; failedDuration=1m 31s; cachedDuration=3h 48m 53s;loadCpus=0; loadMemory=0; peakRunning=1; peakCpus=1; peakMemory=0; ]
10月-12 17:18:02.645 [main] DEBUG nextflow.CacheDB - Closing CacheDB done
10月-12 17:18:02.680 [main] DEBUG nextflow.script.ScriptRunner - > Execution complete -- Goodbye
